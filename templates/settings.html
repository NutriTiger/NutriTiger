{% extends "layout.html" %}
{% set current_page = 'settings' %}
{% block title %}Settings{% endblock %}
{% block content %}
        <div class="row p-md-5 p-sm-4 p-3 mx-auto">
        <div class="card">
        <div class="card-body">
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="settings-tab-pane" role="tabpanel" aria-labelledby="settings-tab" tabindex="0">
                    <h1 class="py-3 text-center">{{ netid }}'s Profile Settings</h1>
                    <div class="text-center p-4">
                        <div class="row">
                            <h5>Join Date: {{ join_date }}</h5>
                            <h5>Current Calorie Goal: {{ current_cal_goal }}</h5>
                            <br><br><br>
                            <h4>Calorie Goal:</h4>
                            {% include 'caloriecalculator.html' %}
                            <form action="/settings" method="post">
                                <input id="settingsCalorieInput" type="number" class="form-control form-calgoal container"
                                    name='line' placeholder="Enter the number here." min="1" max="100000"
                                    onkeypress="return isValid(event)" required autofocus>
                                <div class="p-3">
                                    <button id="caloriesSettingsButton" class="btn btn-primary btn-lg btn-block"
                                    type="submit" onclick="closeForm()">Save</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
{% endblock %}
{% block script %}
<script>
    // Validate the serving inputs
    function isValid(input) {
        var charCode = input.which || input.keyCode;
        var value = input.target.value;
    
        // If the pressed key is a '-'
        if (input.charCode === 45)
            return false;
    
        // If the key contains nonvalid chars 
        if (input.charCode < 48 || input.charCode > 57)
            return false;
    
        return true;
    }

    // When the user submits the form and all fields are valid, lock it
    function closeForm() {
        // Obtain form elements
        var validFormElements = document.querySelector(":valid")
        var calorieInput = validFormElements.querySelector("input")
        var settingsButton = validFormElements.querySelector("button")

        // Check if the input was validated
        if (calorieInput != null) {
            // Remove any leading zeros
            var currentNumber = calorieInput.value
            calorieInput.value = currentNumber.replace(/^0+/, '')

            // Disable the button but have it submit the form
            calorieInput.readOnly = true
            settingsButton.style.pointerEvents = "none"
            settingsButton.textContent = "Submitting..."
            settingsButton.style.opacity = "var(--bs-btn-disabled-opacity)"
        }
    }

    // If the user hits the back button reset the form
    window.onunload = function() {
        var calorieInput = document.getElementById("settingsCalorieInput")
        var settingsButton = document.getElementById("caloriesSettingsButton")

        calorieInput.readOnly = false
        settingsButton.style.pointerEvents = "auto"
        settingsButton.textContent = "Save"
        settingsButton.style.opacity = "none"
    } 
</script>
{% endblock %}
